# code generated by retab v0.71.0. DO NOT EDIT.
# join the fight against yaml @ github.com/walteh/retab

# source: ".retab/task.retab"

version: 3
tasks:
    tools:
        sources:
            - ./tools/**/*
            - exclude: ./tools/bin/*
        generates:
            - ./tools/bin/*
        cmds:
            - go generate ./tools
    tidy:
        cmds:
            - go mod tidy
    update:
        aliases:
            - upgrade
        cmds:
            - go get -u -v ./... && go mod tidy
    generate:
        deps:
            - retab-gen
            - buf-gen
            - mockery-gen
    buf-gen:
        deps:
            - tools
            - retab-gen
        generates:
            - gen/buf/**/*
        sources:
            - proto/core/buf.gen.yaml
            - proto/**/*.proto
        cmds:
            - tools/bin/buf generate --template=proto/core/buf.gen.yaml --path=proto/core
            - find gen/buf/** -type f -mmin +5 -delete
    mockery-gen:
        deps:
            - tools
            - retab-gen
        generates:
            - gen/mockery/**/*
        sources:
            - .mockery.yaml
            - tools/bin/mockery
        cmds:
            - 'tools/bin/mockery --dir gen/mockery --config .mockery.yaml '
            - find gen/mockery -type f -mmin +5 -delete
    retab-gen:
        run: when_changed
        deps:
            - tools
        generates: []
        sources:
            - .retab/*.retab
            - tools/bin/retab
        cmds:
            - tools/bin/retab fmt
            - tools/bin/retab gen
    lint:
        deps:
            - tools
            - retab-gen
        sources:
            - '**/*.go'
            - exclude: tools/**/*
            - tools/bin/golangci-lint
        cmds:
            - tools/bin/golangci-lint run  --config .golangci.yaml --fix
    test:
        deps:
            - tools
        dir: .
        sources:
            - '**/*.go'
            - exclude: '**/*'
            - tools/bin/gotestsum
        preconditions:
            - which go
        cmds:
            - tools/bin/gotestsum -- -v -coverprofile=coverage.out -coverpkg=./... -e all
    test-ci:
        deps:
            - tools
        dir: .
        sources:
            - '**/*.go'
            - exclude: '**/*'
            - tools/bin/gotestsum
        preconditions:
            - which go
        cmds:
            - tools/bin/gotestsum --junitfile test-reports/junit.xml -- -v -coverprofile=coverage.out -coverpkg=./... -e all
